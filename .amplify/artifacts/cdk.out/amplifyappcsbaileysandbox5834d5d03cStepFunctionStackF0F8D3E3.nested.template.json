{
 "Description": "{\"createdOn\":\"Mac\",\"createdBy\":\"AmplifySandbox\",\"createdWith\":\"1.0.4\",\"stackType\":\"custom\",\"metadata\":{}}",
 "Resources": {
  "VideoUploadStateMachineMediaConvertRoleA9EA2594": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "mediaconvert.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     "arn:aws:iam::aws:policy/AmazonAPIGatewayInvokeFullAccess",
     "arn:aws:iam::aws:policy/AmazonS3FullAccess"
    ],
    "Tags": [
     {
      "Key": "amplify:deployment-type",
      "Value": "sandbox"
     },
     {
      "Key": "created-by",
      "Value": "amplify"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/MediaConvertRole/Resource"
   }
  },
  "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrockServiceRole0D32C141": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ],
    "Tags": [
     {
      "Key": "amplify:deployment-type",
      "Value": "sandbox"
     },
     {
      "Key": "created-by",
      "Value": "amplify"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/ExtractTopicsFunc/ExtractTopicsBedrock/ServiceRole/Resource"
   }
  },
  "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrockServiceRoleDefaultPolicy2AE6288F": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:GetObject*",
        "s3:GetBucket*",
        "s3:List*",
        "s3:DeleteObject*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging",
        "s3:Abort*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADArn"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADArn"
           },
           "/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHistoryNestedStackHistoryNestedStackResource632D694FOutputsamplifyappcsbaileysandbox5834d5d03F8BA6F88"
        },
        {
         "Ref": "AWS::NoValue"
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHighlightNestedStackHighlightNestedStackResourceCE969592Outputsamplifyappcsbaileysandbox5834d92FCFC13"
        },
        {
         "Ref": "AWS::NoValue"
        }
       ]
      },
      {
       "Action": "bedrock:InvokeModel",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrockServiceRoleDefaultPolicy2AE6288F",
    "Roles": [
     {
      "Ref": "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrockServiceRole0D32C141"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/ExtractTopicsFunc/ExtractTopicsBedrock/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrock59985044": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "997baec64d2d069fb81b2720edb33a66120e6eccede0d3ec44d80d2ab107659a.zip"
    },
    "Environment": {
     "Variables": {
      "BUCKET_NAME": {
       "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADRef"
      },
      "HISTORY_TABLE_NAME": {
       "Fn::Select": [
        1,
        {
         "Fn::Split": [
          "/",
          {
           "Fn::Select": [
            5,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHistoryNestedStackHistoryNestedStackResource632D694FOutputsamplifyappcsbaileysandbox5834d5d03F8BA6F88"
              }
             ]
            }
           ]
          }
         ]
        }
       ]
      },
      "HIGHLIGHT_TABLE_NAME": {
       "Fn::Select": [
        1,
        {
         "Fn::Split": [
          "/",
          {
           "Fn::Select": [
            5,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHighlightNestedStackHighlightNestedStackResourceCE969592Outputsamplifyappcsbaileysandbox5834d92FCFC13"
              }
             ]
            }
           ]
          }
         ]
        }
       ]
      }
     }
    },
    "Handler": "lambda_function.lambda_handler",
    "MemorySize": 512,
    "Role": {
     "Fn::GetAtt": [
      "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrockServiceRole0D32C141",
      "Arn"
     ]
    },
    "Runtime": "python3.12",
    "Tags": [
     {
      "Key": "amplify:deployment-type",
      "Value": "sandbox"
     },
     {
      "Key": "created-by",
      "Value": "amplify"
     }
    ],
    "Timeout": 600
   },
   "DependsOn": [
    "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrockServiceRoleDefaultPolicy2AE6288F",
    "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrockServiceRole0D32C141"
   ],
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/ExtractTopicsFunc/ExtractTopicsBedrock/Resource",
    "aws:asset:path": "asset.997baec64d2d069fb81b2720edb33a66120e6eccede0d3ec44d80d2ab107659a",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockServiceRole223EC598": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ],
    "Tags": [
     {
      "Key": "amplify:deployment-type",
      "Value": "sandbox"
     },
     {
      "Key": "created-by",
      "Value": "amplify"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/ProcessTopicFunc/ProcessTopicsBedrock/ServiceRole/Resource"
   }
  },
  "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockServiceRoleDefaultPolicy4CA5C91D": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:GetObject*",
        "s3:GetBucket*",
        "s3:List*",
        "s3:DeleteObject*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging",
        "s3:Abort*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADArn"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADArn"
           },
           "/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHistoryNestedStackHistoryNestedStackResource632D694FOutputsamplifyappcsbaileysandbox5834d5d03F8BA6F88"
        },
        {
         "Ref": "AWS::NoValue"
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHighlightNestedStackHighlightNestedStackResourceCE969592Outputsamplifyappcsbaileysandbox5834d92FCFC13"
        },
        {
         "Ref": "AWS::NoValue"
        }
       ]
      },
      {
       "Action": "bedrock:InvokeModel",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockServiceRoleDefaultPolicy4CA5C91D",
    "Roles": [
     {
      "Ref": "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockServiceRole223EC598"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/ProcessTopicFunc/ProcessTopicsBedrock/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockF0791158": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "69e20684949c10d42b8e93e14ff0f71508f7506ef7885c0ed707e50c762d8b73.zip"
    },
    "Environment": {
     "Variables": {
      "BUCKET_NAME": {
       "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADRef"
      },
      "HISTORY_TABLE_NAME": {
       "Fn::Select": [
        1,
        {
         "Fn::Split": [
          "/",
          {
           "Fn::Select": [
            5,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHistoryNestedStackHistoryNestedStackResource632D694FOutputsamplifyappcsbaileysandbox5834d5d03F8BA6F88"
              }
             ]
            }
           ]
          }
         ]
        }
       ]
      },
      "HIGHLIGHT_TABLE_NAME": {
       "Fn::Select": [
        1,
        {
         "Fn::Split": [
          "/",
          {
           "Fn::Select": [
            5,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHighlightNestedStackHighlightNestedStackResourceCE969592Outputsamplifyappcsbaileysandbox5834d92FCFC13"
              }
             ]
            }
           ]
          }
         ]
        }
       ]
      }
     }
    },
    "Handler": "lambda_function.lambda_handler",
    "MemorySize": 512,
    "Role": {
     "Fn::GetAtt": [
      "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockServiceRole223EC598",
      "Arn"
     ]
    },
    "Runtime": "python3.12",
    "Tags": [
     {
      "Key": "amplify:deployment-type",
      "Value": "sandbox"
     },
     {
      "Key": "created-by",
      "Value": "amplify"
     }
    ],
    "Timeout": 600
   },
   "DependsOn": [
    "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockServiceRoleDefaultPolicy4CA5C91D",
    "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockServiceRole223EC598"
   ],
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/ProcessTopicFunc/ProcessTopicsBedrock/Resource",
    "aws:asset:path": "asset.69e20684949c10d42b8e93e14ff0f71508f7506ef7885c0ed707e50c762d8b73",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframeServiceRole6FF3ABFB": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ],
    "Tags": [
     {
      "Key": "amplify:deployment-type",
      "Value": "sandbox"
     },
     {
      "Key": "created-by",
      "Value": "amplify"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/ExtractTimeframeFunc/ExtractTimeframe/ServiceRole/Resource"
   }
  },
  "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframeServiceRoleDefaultPolicy9BE33434": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:GetObject*",
        "s3:GetBucket*",
        "s3:List*",
        "s3:DeleteObject*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging",
        "s3:Abort*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADArn"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADArn"
           },
           "/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHighlightNestedStackHighlightNestedStackResourceCE969592Outputsamplifyappcsbaileysandbox5834d92FCFC13"
        },
        {
         "Ref": "AWS::NoValue"
        }
       ]
      },
      {
       "Action": "mediaconvert:*",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframeServiceRoleDefaultPolicy9BE33434",
    "Roles": [
     {
      "Ref": "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframeServiceRole6FF3ABFB"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/ExtractTimeframeFunc/ExtractTimeframe/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframe0BB6F0C6": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "59bafe270bf2ffd2fa3c09c8282eb0e450a3a8552bf3da4a7e708ea19f682d3c.zip"
    },
    "Environment": {
     "Variables": {
      "BUCKET_NAME": {
       "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADRef"
      },
      "HIGHLIGHT_TABLE_NAME": {
       "Fn::Select": [
        1,
        {
         "Fn::Split": [
          "/",
          {
           "Fn::Select": [
            5,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHighlightNestedStackHighlightNestedStackResourceCE969592Outputsamplifyappcsbaileysandbox5834d92FCFC13"
              }
             ]
            }
           ]
          }
         ]
        }
       ]
      }
     }
    },
    "Handler": "lambda_function.lambda_handler",
    "Role": {
     "Fn::GetAtt": [
      "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframeServiceRole6FF3ABFB",
      "Arn"
     ]
    },
    "Runtime": "python3.12",
    "Tags": [
     {
      "Key": "amplify:deployment-type",
      "Value": "sandbox"
     },
     {
      "Key": "created-by",
      "Value": "amplify"
     }
    ],
    "Timeout": 600
   },
   "DependsOn": [
    "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframeServiceRoleDefaultPolicy9BE33434",
    "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframeServiceRole6FF3ABFB"
   ],
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/ExtractTimeframeFunc/ExtractTimeframe/Resource",
    "aws:asset:path": "asset.59bafe270bf2ffd2fa3c09c8282eb0e450a3a8552bf3da4a7e708ea19f682d3c",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "VideoUploadStateMachineRole15ED27D0": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "states.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Tags": [
     {
      "Key": "amplify:deployment-type",
      "Value": "sandbox"
     },
     {
      "Key": "created-by",
      "Value": "amplify"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/VideoUploadStateMachine/Role/Resource"
   }
  },
  "VideoUploadStateMachineRoleDefaultPolicy0B091480": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "s3:HeadObject",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "dynamodb:UpdateItem",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":dynamodb:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":table/",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHistoryNestedStackHistoryNestedStackResource632D694FOutputsamplifyappcsbaileysandbox5834d5d03F8BA6F88"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          }
         ]
        ]
       }
      },
      {
       "Action": "transcribe:GetTranscriptionJob",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "transcribe:StartTranscriptionJob",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "events:PutEvents",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":events:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":event-bus/default"
         ]
        ]
       }
      },
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrock59985044",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrock59985044",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframe0BB6F0C6",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframe0BB6F0C6",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "iam:PassRole",
       "Condition": {
        "StringLike": {
         "iam:PassedToService": "mediaconvert.amazonaws.com"
        }
       },
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "VideoUploadStateMachineMediaConvertRoleA9EA2594",
         "Arn"
        ]
       }
      },
      {
       "Action": "mediaconvert:CreateJob",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": [
        "mediaconvert:GetJob",
        "mediaconvert:CancelJob"
       ],
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": [
        "events:PutTargets",
        "events:PutRule",
        "events:DescribeRule"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":events:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":rule/StepFunctionsGetEventsForMediaConvertJobRule"
         ]
        ]
       }
      },
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockF0791158",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockF0791158",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "s3:GetObject*",
        "s3:GetBucket*",
        "s3:List*",
        "s3:DeleteObject*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging",
        "s3:Abort*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADArn"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADArn"
           },
           "/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "VideoUploadStateMachineRoleDefaultPolicy0B091480",
    "Roles": [
     {
      "Ref": "VideoUploadStateMachineRole15ED27D0"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/VideoUploadStateMachine/Role/DefaultPolicy/Resource"
   }
  },
  "VideoUploadStateMachine3E230CD6": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"PrepareParameters\",\"States\":{\"PrepareParameters\":{\"Type\":\"Pass\",\"Parameters\":{\"uuid.$\":\"States.Format('{}', States.ArrayGetItem(States.StringSplit($.detail.object.key, '/'), 1))\",\"TranscriptionJobName.$\":\"States.Format('{}_stepFunction', States.ArrayGetItem(States.StringSplit($.detail.object.key, '/'), 1))\",\"raw_file_uri.$\":\"States.Format('s3://{}/{}', $.detail.bucket.name, $.detail.object.key)\",\"bucket_name.$\":\"$.detail.bucket.name\",\"OutputKey.$\":\"States.Format('videos/{}/Transcript.json', States.ArrayGetItem(States.StringSplit($.detail.object.key, '/'), 1))\"},\"Next\":\"CheckSubtitles\"},\"CheckSubtitles\":{\"Next\":\"UpdateDDBStage1\",\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":null,\"Next\":\"StartTranscriptionJob\"}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:s3:headObject\",\"Parameters\":{\"Bucket.$\":\"$.bucket_name\",\"Key.$\":\"States.Format('videos/{}/Transcript.json', $.uuid)\"}},\"UpdateDDBStage1\":{\"Next\":\"UpdateEventStage1\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::dynamodb:updateItem\",\"Parameters\":{\"Key\":{\"id\":{\"S.$\":\"$.uuid\"}},\"TableName\":\"",
       {
        "Fn::Select": [
         1,
         {
          "Fn::Split": [
           "/",
           {
            "Fn::Select": [
             5,
             {
              "Fn::Split": [
               ":",
               {
                "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHistoryNestedStackHistoryNestedStackResource632D694FOutputsamplifyappcsbaileysandbox5834d5d03F8BA6F88"
               }
              ]
             }
            ]
           }
          ]
         }
        ]
       },
       "\",\"ExpressionAttributeValues\":{\":val\":{\"N\":\"1\"}},\"UpdateExpression\":\"SET stage = :val\"}},\"CheckTranscriptionJobStatus\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.jobStatus.TranscriptionJob.TranscriptionJobStatus\",\"StringEquals\":\"COMPLETED\",\"Next\":\"UpdateDDBStage1\"},{\"Variable\":\"$.jobStatus.TranscriptionJob.TranscriptionJobStatus\",\"StringEquals\":\"FAILED\",\"Next\":\"TranscriptionJobFailed\"}],\"Default\":\"WaitForTranscriptionJob\"},\"GetTranscriptionJobStatus\":{\"Next\":\"CheckTranscriptionJobStatus\",\"Type\":\"Task\",\"ResultPath\":\"$.jobStatus\",\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:transcribe:getTranscriptionJob\",\"Parameters\":{\"TranscriptionJobName.$\":\"$.TranscriptionJobName\"}},\"WaitForTranscriptionJob\":{\"Type\":\"Wait\",\"Seconds\":5,\"Next\":\"GetTranscriptionJobStatus\"},\"StartTranscriptionJob\":{\"Next\":\"WaitForTranscriptionJob\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:transcribe:startTranscriptionJob\",\"Parameters\":{\"TranscriptionJobName.$\":\"$.TranscriptionJobName\",\"Media\":{\"MediaFileUri.$\":\"$.raw_file_uri\"},\"OutputBucketName.$\":\"$.bucket_name\",\"OutputKey.$\":\"$.OutputKey\",\"LanguageOptions\":[\"en-US\",\"ko-KR\"],\"IdentifyLanguage\":true}},\"TranscriptionJobFailed\":{\"Type\":\"Fail\",\"Error\":\"TranscriptionJobFailed\",\"Cause\":\"Transcription job failed\"},\"UpdateEventStage1\":{\"Next\":\"ExtractTopics\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::events:putEvents\",\"Parameters\":{\"Entries\":[{\"Detail\":{\"videoId.$\":\"$.uuid\",\"stage\":1},\"DetailType\":\"StageChanged\",\"Source\":\"custom.aws-shorts\"}]}},\"ExtractTopics\":{\"Next\":\"ProcessTopicsMap\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"ResultPath\":\"$.TopicsResult\",\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",
       {
        "Fn::GetAtt": [
         "VideoUploadStateMachineExtractTopicsFuncExtractTopicsBedrock59985044",
         "Arn"
        ]
       },
       "\",\"Payload.$\":\"$\"}},\"ProcessTopicsMap\":{\"Type\":\"Map\",\"ResultPath\":null,\"Next\":\"UpdateDDBStage2\",\"Parameters\":{\"topic.$\":\"$$.Map.Item.Value\",\"topics.$\":\"$.TopicsResult.Payload.topics\",\"uuid.$\":\"$.uuid\",\"index.$\":\"$$.Map.Item.Index\",\"script.$\":\"$.TopicsResult.Payload.script\",\"modelID.$\":\"$.TopicsResult.Payload.modelID\",\"owner.$\":\"$.TopicsResult.Payload.owner\",\"bucket_name.$\":\"$.bucket_name\"},\"ItemsPath\":\"$.TopicsResult.Payload.topics\",\"ItemProcessor\":{\"ProcessorConfig\":{\"Mode\":\"INLINE\"},\"StartAt\":\"ProcessTopic\",\"States\":{\"ProcessTopic\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",
       {
        "Fn::GetAtt": [
         "VideoUploadStateMachineProcessTopicFuncProcessTopicsBedrockF0791158",
         "Arn"
        ]
       },
       "\",\"Payload.$\":\"$\"}}}},\"MaxConcurrency\":5},\"UpdateDDBStage2\":{\"Next\":\"UpdateEventStage2\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::dynamodb:updateItem\",\"Parameters\":{\"Key\":{\"id\":{\"S.$\":\"$.uuid\"}},\"TableName\":\"",
       {
        "Fn::Select": [
         1,
         {
          "Fn::Split": [
           "/",
           {
            "Fn::Select": [
             5,
             {
              "Fn::Split": [
               ":",
               {
                "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHistoryNestedStackHistoryNestedStackResource632D694FOutputsamplifyappcsbaileysandbox5834d5d03F8BA6F88"
               }
              ]
             }
            ]
           }
          ]
         }
        ]
       },
       "\",\"ExpressionAttributeValues\":{\":val\":{\"N\":\"2\"}},\"UpdateExpression\":\"SET stage = :val\"}},\"UpdateEventStage2\":{\"Next\":\"HighlightExtractMap\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::events:putEvents\",\"Parameters\":{\"Entries\":[{\"Detail\":{\"videoId.$\":\"$.uuid\",\"stage\":2},\"DetailType\":\"StageChanged\",\"Source\":\"custom.aws-shorts\"}]}},\"HighlightExtractMap\":{\"Type\":\"Map\",\"ResultPath\":null,\"Next\":\"UpdateDDBStage3\",\"Parameters\":{\"topic.$\":\"$$.Map.Item.Value\",\"uuid.$\":\"$.uuid\",\"index.$\":\"$$.Map.Item.Index\",\"bucket_name.$\":\"$.bucket_name\"},\"ItemsPath\":\"$.TopicsResult.Payload.topics\",\"ItemProcessor\":{\"ProcessorConfig\":{\"Mode\":\"INLINE\"},\"StartAt\":\"ExtractTimeframe\",\"States\":{\"ExtractTimeframe\":{\"Next\":\"CheckExtractionJobStatus\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"ResultPath\":\"$.timeframe_extracted\",\"ResultSelector\":{\"statusCode.$\":\"$.Payload.statusCode\",\"duration.$\":\"$.Payload.duration\",\"index.$\":\"$.Payload.index\",\"uuid.$\":\"$.Payload.uuid\",\"raw_file_path.$\":\"$.Payload.raw_file_path\",\"timeframes.$\":\"$.Payload.timeframes\",\"output_destination.$\":\"$.Payload.output_destination\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",
       {
        "Fn::GetAtt": [
         "VideoUploadStateMachineExtractTimeframeFuncExtractTimeframe0BB6F0C6",
         "Arn"
        ]
       },
       "\",\"Payload.$\":\"$\"}},\"CheckExtractionJobStatus\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.timeframe_extracted.statusCode\",\"NumericEquals\":200,\"Next\":\"MediaConvertExtractJob\"}],\"Default\":\"ExtractionFailed\"},\"ExtractionFailed\":{\"Type\":\"Pass\",\"End\":true},\"MediaConvertExtractJob\":{\"Next\":\"MediaConvertExtractJobParam\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::mediaconvert:createJob.sync\",\"Parameters\":{\"Role\":\"",
       {
        "Fn::GetAtt": [
         "VideoUploadStateMachineMediaConvertRoleA9EA2594",
         "Arn"
        ]
       },
       "\",\"Settings\":{\"TimecodeConfig\":{\"Source\":\"ZEROBASED\"},\"Inputs\":[{\"FileInput.$\":\"$.timeframe_extracted.raw_file_path\",\"AudioSelectors\":{\"Audio Selector 1\":{\"DefaultSelection\":\"DEFAULT\"}},\"VideoSelector\":{},\"TimecodeSource\":\"ZEROBASED\",\"InputClippings.$\":\"$.timeframe_extracted.timeframes\"}],\"OutputGroups\":[{\"Name\":\"FileGroup\",\"Outputs\":[{\"ContainerSettings\":{\"Container\":\"MP4\",\"Mp4Settings\":{}},\"VideoDescription\":{\"Width\":1920,\"ScalingBehavior\":\"FIT\",\"Height\":1080,\"CodecSettings\":{\"Codec\":\"H_264\",\"H264Settings\":{\"FramerateDenominator\":1,\"MaxBitrate\":5000000,\"FramerateControl\":\"SPECIFIED\",\"RateControlMode\":\"QVBR\",\"FramerateNumerator\":25,\"SceneChangeDetect\":\"TRANSITION_DETECTION\"}}},\"AudioDescriptions\":[{\"CodecSettings\":{\"Codec\":\"AAC\",\"AacSettings\":{\"Bitrate\":96000,\"CodingMode\":\"CODING_MODE_2_0\",\"SampleRate\":48000}}}]}],\"OutputGroupSettings\":{\"Type\":\"FILE_GROUP_SETTINGS\",\"FileGroupSettings\":{\"Destination.$\":\"$.timeframe_extracted.output_destination\"}}}]}}},\"MediaConvertExtractJobParam\":{\"Type\":\"Pass\",\"ResultPath\":\"$.FHD_Job\",\"Parameters\":{\"FHD_Jobname.$\":\"States.Format('{}_FHD_{}', $.timeframe_extracted.uuid, $.timeframe_extracted.index)\",\"FHD_SourceKey.$\":\"States.Format('{}.mp4', $.timeframe_extracted.output_destination)\",\"FHD_OutputKey.$\":\"States.Format('videos/{}/ShortsTranscript/{}-TranscriptShorts.json', $.timeframe_extracted.uuid, $.timeframe_extracted.index)\"},\"Next\":\"StartHighlightTranscriptionJob\"},\"StartHighlightTranscriptionJob\":{\"Next\":\"WaitForHighlightTranscriptionJob\",\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":5,\"MaxAttempts\":3}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:transcribe:startTranscriptionJob\",\"Parameters\":{\"TranscriptionJobName.$\":\"$.FHD_Job.FHD_Jobname\",\"MediaFormat\":\"mp4\",\"Media\":{\"MediaFileUri.$\":\"$.FHD_Job.FHD_SourceKey\"},\"OutputBucketName.$\":\"$.bucket_name\",\"OutputKey.$\":\"$.FHD_Job.FHD_OutputKey\",\"LanguageOptions\":[\"en-US\",\"ko-KR\"],\"IdentifyLanguage\":true,\"Subtitles\":{\"Formats\":[\"vtt\"],\"OutputStartIndex\":1}}},\"WaitForHighlightTranscriptionJob\":{\"Type\":\"Wait\",\"Seconds\":5,\"Next\":\"GetHighlightTranscriptionJobStatus\"},\"GetHighlightTranscriptionJobStatus\":{\"Next\":\"CheckHighlightTranscriptionJobStatus\",\"Type\":\"Task\",\"ResultPath\":\"$.highlightJobStatus\",\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:transcribe:getTranscriptionJob\",\"Parameters\":{\"TranscriptionJobName.$\":\"$.FHD_Job.FHD_Jobname\"}},\"CheckHighlightTranscriptionJobStatus\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.highlightJobStatus.TranscriptionJob.TranscriptionJobStatus\",\"StringEquals\":\"COMPLETED\",\"Next\":\"HighlightTranscriptionSucceeded\"},{\"Variable\":\"$.highlightJobStatus.TranscriptionJob.TranscriptionJobStatus\",\"StringEquals\":\"FAILED\",\"Next\":\"HighlightTranscriptionFailed\"}],\"Default\":\"WaitForHighlightTranscriptionJob\"},\"HighlightTranscriptionSucceeded\":{\"Type\":\"Succeed\"},\"HighlightTranscriptionFailed\":{\"Type\":\"Fail\",\"Error\":\"HighlightTranscriptionJobFailed\",\"Cause\":\"Highlight transcription job failed\"}}}},\"UpdateDDBStage3\":{\"Next\":\"UpdateEventStage3\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::dynamodb:updateItem\",\"Parameters\":{\"Key\":{\"id\":{\"S.$\":\"$.uuid\"}},\"TableName\":\"",
       {
        "Fn::Select": [
         1,
         {
          "Fn::Split": [
           "/",
           {
            "Fn::Select": [
             5,
             {
              "Fn::Split": [
               ":",
               {
                "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHistoryNestedStackHistoryNestedStackResource632D694FOutputsamplifyappcsbaileysandbox5834d5d03F8BA6F88"
               }
              ]
             }
            ]
           }
          ]
         }
        ]
       },
       "\",\"ExpressionAttributeValues\":{\":val\":{\"N\":\"3\"}},\"UpdateExpression\":\"SET stage = :val\"}},\"UpdateEventStage3\":{\"End\":true,\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::events:putEvents\",\"Parameters\":{\"Entries\":[{\"Detail\":{\"videoId.$\":\"$.uuid\",\"stage\":3},\"DetailType\":\"StageChanged\",\"Source\":\"custom.aws-shorts\"}]}}},\"Comment\":\"A Step Function to transcribe video using Amazon Transcribe\"}"
      ]
     ]
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "VideoUploadStateMachineRole15ED27D0",
      "Arn"
     ]
    },
    "Tags": [
     {
      "Key": "amplify:deployment-type",
      "Value": "sandbox"
     },
     {
      "Key": "created-by",
      "Value": "amplify"
     }
    ]
   },
   "DependsOn": [
    "VideoUploadStateMachineRoleDefaultPolicy0B091480",
    "VideoUploadStateMachineRole15ED27D0"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachine/VideoUploadStateMachine/Resource"
   }
  },
  "VideoUploadStateMachineExecuteRole94261CDA": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "events.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Policies": [
     {
      "PolicyDocument": {
       "Statement": [
        {
         "Action": "states:StartExecution",
         "Effect": "Allow",
         "Resource": "*"
        }
       ],
       "Version": "2012-10-17"
      },
      "PolicyName": "PolicyStatement"
     }
    ],
    "Tags": [
     {
      "Key": "amplify:deployment-type",
      "Value": "sandbox"
     },
     {
      "Key": "created-by",
      "Value": "amplify"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachineExecuteRole/Resource"
   }
  },
  "VideoUploadStateMachineRule": {
   "Type": "AWS::Events::Rule",
   "Properties": {
    "EventPattern": {
     "source": [
      "aws.s3"
     ],
     "detail-type": [
      "Object Created"
     ],
     "detail": {
      "bucket": {
       "name": [
        {
         "Ref": "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADRef"
        }
       ]
      },
      "object": {
       "key": [
        {
         "wildcard": "*/RAW.mp4"
        }
       ]
      }
     }
    },
    "Targets": [
     {
      "Arn": {
       "Ref": "VideoUploadStateMachine3E230CD6"
      },
      "Id": "videoUploadStateMachine",
      "RoleArn": {
       "Fn::GetAtt": [
        "VideoUploadStateMachineExecuteRole94261CDA",
        "Arn"
       ]
      }
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/VideoUploadStateMachineRule"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/1VQ0W7CMAz8Ft5NNpj4AOiGxDQmBJr2iExiimmaoCYpQlX/fW4Y0vZ0Pp11d/ZUTWYT9TzCaxhrU40tH1T3SSGS2UXUFYiw7xhr1W29JSiOLuPGW9a3gd6nHizWB4OqWyanI3s3aI+5h/CyxxAoBjUfQLhaJF1RXGAgkLjL8Xc3qG4jq/CNHKE4edYEa7zAEtnCLmlNZEC6RVqjPrHLnf7y/r/dPmKoxLRAa+fXsKOmHSw/ct2Va30l/mQYC+9aamLRkHi9+wO83hzW/utihK8i1fDWkouLhk1JmxQzCz1QRjV8JllJ31LwqZGIfKk0K9mV+XEPQWYJM3x/jfOG1Dk8tdOpmqnJ6ByYx01ykWtS2zv+ALeY1eqnAQAA"
   },
   "Metadata": {
    "aws:cdk:path": "amplify-app-csbailey-sandbox-5834d5d03c/StepFunctionStack/CDKMetadata/Default"
   },
   "Condition": "CDKMetadataAvailable"
  }
 },
 "Conditions": {
  "CDKMetadataAvailable": {
   "Fn::Or": [
    {
     "Fn::Or": [
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "af-south-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-east-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-northeast-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-northeast-2"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-south-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-southeast-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-southeast-2"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ca-central-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "cn-north-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "cn-northwest-1"
       ]
      }
     ]
    },
    {
     "Fn::Or": [
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-central-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-north-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-south-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-west-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-west-2"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-west-3"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "il-central-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "me-central-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "me-south-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "sa-east-1"
       ]
      }
     ]
    },
    {
     "Fn::Or": [
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "us-east-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "us-east-2"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "us-west-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "us-west-2"
       ]
      }
     ]
    }
   ]
  }
 },
 "Parameters": {
  "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADArn": {
   "Type": "String"
  },
  "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHistoryNestedStackHistoryNestedStackResource632D694FOutputsamplifyappcsbaileysandbox5834d5d03F8BA6F88": {
   "Type": "String"
  },
  "referencetoamplifyappcsbaileysandbox5834d5d03cdataNestedStackdataNestedStackResource21649687Outputsamplifyappcsbaileysandbox5834d5d03cdataAWSShortsHighlightNestedStackHighlightNestedStackResourceCE969592Outputsamplifyappcsbaileysandbox5834d92FCFC13": {
   "Type": "String"
  },
  "referencetoamplifyappcsbaileysandbox5834d5d03cstorageNestedStackstorageNestedStackResourceAF26F164Outputsamplifyappcsbaileysandbox5834d5d03cstorageawsshortsBucketD0C3C9ADRef": {
   "Type": "String"
  }
 }
}